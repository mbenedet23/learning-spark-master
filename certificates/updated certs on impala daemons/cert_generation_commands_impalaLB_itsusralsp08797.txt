Impala Daemon: itsusralsp08797.jnj.com  /  ITSUSRALSP08797

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

openssl req -new -newkey rsa:2048 -nodes -out ITSUSRALSP08797_jnj_com.txt -keyout ITSUSRALSP08797_jnj_com.key -subj "/C=US/ST=NJ/L=Raritan/O=JNJ/OU=EDL/CN=ITSUSRALSP08797.jnj.com" -config /home/abaseerm/794_certs/openssl.conf


mv  "JNJ 2015 Issuing CA.cer" entrustintermediate.cer

mv  "JNJ 2015 Root CA.cer" entrustroot.cer



openssl pkcs7 -in 2ECF93CE3CC636D75F15CD3988E8B3C1.p7b  -inform DER -print_certs -out ITSUSRALSP08797.pem
openssl x509 -inform der -in entrustroot.cer -out entrustroot.pem
openssl x509 -inform der -in entrustintermediate.cer -out entrustintermediate.pem


cat ITSUSRALSP08797.pem entrustintermediate.pem entrustroot.pem > cert-chain.pem


•             Change this PEM certificate into a PKCS12 file

openssl pkcs12 -export -inkey ITSUSRALSP08797_jnj_com.key -in cert-chain.pem -out cert-chain.pkcs12

Enter the password as “Cloudera@6”
Create a keystore from the PKCS12 file. This keystore will have the private key and the 3 certs that are required. Set the PATH for JAVA so that “keytool” is found.

cd /usr/java
export PATH=/usr/java/1.8.0_181/bin:$PATH

cd /home/abaseerm/794_certs

keytool -importkeystore -srckeystore cert-chain.pkcs12 -srcstoretype PKCS12 -destkeystore keystore.jks

** Enter the destination password as “Cloudera@5” and the source as “Cloudera@6”



Create the “security” related folders
#-> mkdir /opt/cloudera/security
[root@ITSUSRALSP07674:/opt/cloudera]#
#-> cd /opt/cloudera/security
[root@ITSUSRALSP07674:/opt/cloudera/security]#
#-> mkdir CAcerts
[root@ITSUSRALSP07674:/opt/cloudera/security]#
#-> mkdir jks
[root@ITSUSRALSP07674:/opt/cloudera/security]#
#-> mkdir x509
[root@ITSUSRALSP07674:/opt/cloudera/security]#


•             Copy the generated key as “server.key” and “server.pem”
to “x509” folder

cp ITSUSRALSP08797_jnj_com.key /opt/cloudera/security/x509/server.key
cp ITSUSRALSP08797.pem /opt/cloudera/security/x509/server.pem

Create below password file inside x509
•             Create a password file “serverkey.pw” with content “Cloudera@6”. That’s the password we gave for destination.

#-> cat serverkey.pw
Cloudera@5

•             Create “combinedtrust.pem” 

[root@ITSUSRALSP07674:/home/aomtri/7553_servercert]#
#-> cat entrustroot.pem > combinedtrust.pem
[root@ITSUSRALSP07674:/home/aomtri/7553_servercert]#
#-> cat entrustintermediate.pem >> combinedtrust.pem

•             Copy the “combinedtrust.pem to “CAcerts

cp combinedtrust.pem /opt/cloudera/security/CAcerts/

•             Copy the “server.keystore”

cp keystore.jks /opt/cloudera/security/jks/server.keystore

SET File Permissions:

cd /opt/cloudera/security
cd CAcerts
chmod 644  combinedtrust.pem
cd ..
cd jks/
chmod 666 server.keystore
chown cloudera-scm:cloudera-scm server.keystore
cd ..
cd x509/
chmod 440 server.key
chmod 440  serverkey.pw
chmod 444 server.pem
  
 Copy trustorre file from DEV Server on all servers:
scp /opt/cloudera/security/jks/truststore.jks abaseerm@ITSUSRALSP08797:/home/abaseerm/
                                                                                                                     
